// ===================================
// SCRIPT OPTIMIZADO Y CORREGIDO
// Details Barras - Bartender
// ===================================

// 1. PRELOADER
window.addEventListener('load', function() {
    const preloader = document.getElementById('preloader');
    if (preloader) {
        setTimeout(() => {
            preloader.classList.add('hidden');
            setTimeout(() => preloader.remove(), 500);
        }, 1500);
    }
});

// Fallback por si falla el load
setTimeout(() => {
    const preloader = document.getElementById('preloader');
    if (preloader && !preloader.classList.contains('hidden')) {
        preloader.classList.add('hidden');
        setTimeout(() => preloader.remove(), 500);
    }
}, 5000);

// ===================================
// 2. MENÃš HAMBURGUESA
// ===================================
(function initMenu() {
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');
    
    if (!menuToggle || !navLinks) {
        console.warn('âš ï¸ Elementos del menÃº no encontrados');
        return;
    }

    // Toggle menÃº
    menuToggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const isActive = navLinks.classList.contains('active');
        navLinks.classList.toggle('active');
        menuToggle.classList.toggle('active');
        
        console.log('ğŸ” MenÃº:', isActive ? 'Cerrado' : 'Abierto');
    });

    // Cerrar al hacer clic en un link
    navLinks.addEventListener('click', (e) => {
        if (e.target.closest('a')) {
            navLinks.classList.remove('active');
            menuToggle.classList.remove('active');
        }
    });

    // Cerrar al hacer clic fuera
    document.addEventListener('click', (e) => {
        if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
            if (navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
                menuToggle.classList.remove('active');
            }
        }
    });

    console.log('âœ… MenÃº inicializado');
})();

// ===================================
// 3. SMOOTH SCROLL
// ===================================
document.addEventListener('click', (e) => {
    const anchor = e.target.closest('a[href^="#"]');
    if (!anchor) return;
    
    const href = anchor.getAttribute('href');
    if (href === '#') return;
    
    e.preventDefault();
    
    const target = document.querySelector(href);
    if (target) {
        target.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }
});

// ===================================
// 4. FAQ ACCORDION
// ===================================
(function initFAQ() {
    const faqList = document.querySelector('.faq-list');
    if (!faqList) return;

    faqList.addEventListener('click', (e) => {
        const question = e.target.closest('.faq-question');
        if (!question) return;

        const item = question.closest('.faq-item');
        if (!item) return;

        const isActive = item.classList.contains('active');

        // Cerrar todos los demÃ¡s
        document.querySelectorAll('.faq-item').forEach(faqItem => {
            if (faqItem !== item) {
                faqItem.classList.remove('active');
            }
        });

        // Toggle el actual
        item.classList.toggle('active');
    });

    console.log('âœ… FAQ inicializado');
})();

// ===================================
// 5. VIDEO HERO
// ===================================
(function initHeroVideo() {
    const heroVideo = document.querySelector('.hero-video');
    if (!heroVideo) return;

    // Detectar conexiÃ³n lenta
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    const isSlowConnection = connection && (
        connection.effectiveType === 'slow-2g' || 
        connection.effectiveType === '2g' || 
        connection.saveData === true
    );

    if (isSlowConnection) {
        heroVideo.removeAttribute('autoplay');
        heroVideo.preload = 'none';
        console.log('ğŸ“¶ ConexiÃ³n lenta: Video en modo poster');
        return;
    }

    heroVideo.addEventListener('loadeddata', () => {
        console.log('âœ… Video hero cargado');
    }, { once: true });

    heroVideo.addEventListener('error', () => {
        console.warn('âš ï¸ Error al cargar video hero');
        heroVideo.style.display = 'none';
    }, { once: true });
})();

// ===================================
// 6. VIDEO DE SERVICIO
// ===================================
(function initServicioVideo() {
    const playButton = document.getElementById('playButton');
    const servicioVideo = document.querySelector('.servicio-video');
    const videoContainer = document.querySelector('.video-container');

    if (!playButton || !servicioVideo || !videoContainer) return;

    // Play/Pause
    playButton.addEventListener('click', () => {
        if (servicioVideo.paused) {
            servicioVideo.play().catch(err => {
                console.warn('âš ï¸ Error al reproducir:', err);
            });
        } else {
            servicioVideo.pause();
        }
    });

    // Estados del video
    servicioVideo.addEventListener('play', () => {
        videoContainer.classList.add('playing');
    });

    servicioVideo.addEventListener('pause', () => {
        videoContainer.classList.remove('playing');
    });

    servicioVideo.addEventListener('ended', () => {
        videoContainer.classList.remove('playing');
    });

    // Lazy load con IntersectionObserver
    if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    servicioVideo.preload = 'metadata';
                    observer.disconnect(); // âœ… IMPORTANTE: Desconectar despuÃ©s de usarlo
                }
            });
        }, { rootMargin: '200px' });

        observer.observe(servicioVideo);
    }

    console.log('âœ… Video de servicio inicializado');
})();

// ===================================
// 7. GALERÃA Y LIGHTBOX
// ===================================
(function initGaleria() {
    const EVENTOS_DATA = [
        {
            title: 'Boda Elegante',
            subtitle: 'Nordelta 2024',
            description: 'Una boda sofisticada con una barra de cÃ³cteles premium. Creamos una experiencia Ãºnica con tragos personalizados para cada momento de la celebraciÃ³n.',
            location: 'Nordelta, Buenos Aires',
            guests: '200 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670614/gallery-imagen6-detail-barras_wzj9kc.avif'
        },
        {
            title: 'Cocktail Bar',
            subtitle: 'Evento Corporativo',
            description: 'Evento corporativo de alto nivel con barra mÃ³vil de cÃ³cteles clÃ¡sicos y autorales. Servicio profesional para 150 ejecutivos.',
            location: 'CABA, Buenos Aires',
            guests: '150 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670613/gallery-imagen2-detail-barras_wpeeqv.avif'
        },
        {
            title: 'Fiesta TemÃ¡tica',
            subtitle: 'Palermo 2024',
            description: 'Fiesta temÃ¡tica tropical con cÃ³cteles exÃ³ticos y frutales. Ambiente festivo con mÃºsica en vivo y shows de flair bartending.',
            location: 'Palermo, Buenos Aires',
            guests: '180 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670614/gallery-imagen5-detail-barras_wbkgyf.avif'
        },
        {
            title: 'InauguraciÃ³n',
            subtitle: 'Local Belgrano',
            description: 'InauguraciÃ³n de local gastronÃ³mico con barra de autor. Tragos signature especialmente diseÃ±ados para la ocasiÃ³n.',
            location: 'Belgrano, Buenos Aires',
            guests: '120 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670613/gallery-imagen4-detail-barras_b8s1t5.avif'
        },
        {
            title: 'CumpleaÃ±os Premium',
            subtitle: 'Recoleta 2024',
            description: 'CelebraciÃ³n de cumpleaÃ±os exclusiva con barra de cÃ³cteles premium y champagne. Servicio personalizado y atenciÃ³n de lujo.',
            location: 'Recoleta, Buenos Aires',
            guests: '80 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670618/sobre2-mi-detail-barras_icz1aw.avif'
        },
        {
            title: 'After Office',
            subtitle: 'Puerto Madero',
            description: 'After office corporativo con barra de tragos clÃ¡sicos y modernos. Ambiente relajado y profesional para networking.',
            location: 'Puerto Madero, Buenos Aires',
            guests: '100 invitados',
            image: 'https://res.cloudinary.com/dliredzt9/image/upload/v1761670613/gallery-imagen3-detail-barras_fs3zkq.avif'
        }
    ];

    let currentIndex = 0;

    // Elementos
    const galeriaGrid = document.querySelector('.galeria-grid');
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxTitle = document.getElementById('lightboxTitle');
    const lightboxSubtitle = document.getElementById('lightboxSubtitle');
    const lightboxDescription = document.getElementById('lightboxDescription');
    const lightboxLocation = document.getElementById('lightboxLocation');
    const lightboxGuests = document.getElementById('lightboxGuests');
    const closeLightboxBtn = document.getElementById('closeLightbox');
    const prevImageBtn = document.getElementById('prevImage');
    const nextImageBtn = document.getElementById('nextImage');

    if (!galeriaGrid || !lightbox) {
        console.warn('âš ï¸ GalerÃ­a no encontrada');
        return;
    }

    // Actualizar contenido del lightbox
    function updateLightboxContent(evento) {
        lightboxImage.src = evento.image;
        lightboxImage.alt = evento.title;
        lightboxTitle.textContent = evento.title;
        lightboxSubtitle.textContent = evento.subtitle;
        lightboxDescription.textContent = evento.description;
        lightboxLocation.textContent = evento.location;
        lightboxGuests.textContent = evento.guests;
    }

    // Abrir lightbox
    function openLightbox(index) {
        currentIndex = index;
        updateLightboxContent(EVENTOS_DATA[index]);
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
        console.log('ğŸ“¸ Lightbox abierto:', EVENTOS_DATA[index].title);
    }

    // Cerrar lightbox
    function closeLightbox() {
        lightbox.classList.remove('active');
        document.body.style.overflow = 'auto';
        setTimeout(() => {
            lightboxImage.src = ''; // Limpiar imagen
        }, 300);
    }

    // Navegar
    function navigateLightbox(direction) {
        const length = EVENTOS_DATA.length;
        if (direction === 'next') {
            currentIndex = (currentIndex + 1) % length;
        } else {
            currentIndex = (currentIndex - 1 + length) % length;
        }
        updateLightboxContent(EVENTOS_DATA[currentIndex]);
    }

    // Event: Click en "Ver mÃ¡s"
    galeriaGrid.addEventListener('click', (e) => {
        const btnVerMas = e.target.closest('.btn-ver-mas');
        if (!btnVerMas) return;

        e.preventDefault();
        
        const item = btnVerMas.closest('.galeria-item');
        const index = parseInt(item.dataset.index);
        
        if (!isNaN(index)) {
            openLightbox(index);
        }
    });

    // Event: Cerrar
    if (closeLightboxBtn) {
        closeLightboxBtn.addEventListener('click', closeLightbox);
    }

    // Event: NavegaciÃ³n
    if (prevImageBtn) {
        prevImageBtn.addEventListener('click', () => navigateLightbox('prev'));
    }

    if (nextImageBtn) {
        nextImageBtn.addEventListener('click', () => navigateLightbox('next'));
    }

    // Event: Click fuera del contenido
    lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
            closeLightbox();
        }
    });

    // Event: Teclado
    document.addEventListener('keydown', (e) => {
        if (!lightbox.classList.contains('active')) return;

        switch(e.key) {
            case 'Escape':
                closeLightbox();
                break;
            case 'ArrowLeft':
                navigateLightbox('prev');
                break;
            case 'ArrowRight':
                navigateLightbox('next');
                break;
        }
    });

    console.log('âœ… GalerÃ­a inicializada');
})();

// ===================================
// 8. FORMULARIO DE CONTACTO
// ===================================
(function initContactForm() {
    const contactForm = document.getElementById('contactForm');
    if (!contactForm) return;

    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {
            nombre: formData.get('name'),
            email: formData.get('email'),
            telefono: formData.get('phone'),
            mensaje: formData.get('message')
        };

        const texto = `Hola Caro de Details Barras! Me contacto desde tu sitio web:\n\n*Nombre:* ${data.nombre}\n*Email:* ${data.email}\n*TelÃ©fono:* ${data.telefono}\n*Mensaje:* ${data.mensaje}`;

        const url = `https://wa.me/5491134597788?text=${encodeURIComponent(texto)}`;
        
        window.open(url, '_blank', 'noopener,noreferrer');
        
        console.log('ğŸ“± Formulario enviado a WhatsApp');
    });

    console.log('âœ… Formulario inicializado');
})();

// ===================================
// 9. AÃ‘O ACTUAL EN FOOTER
// ===================================
(function initFooter() {
    const yearElement = document.getElementById('currentYear');
    if (yearElement) {
        yearElement.textContent = new Date().getFullYear();
    }
})();

// ===================================
// 10. LAZY LOADING DE IMÃGENES
// ===================================
(function initLazyLoad() {
    if (!('IntersectionObserver' in window)) return;

    const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                const src = img.dataset.src;
                
                if (src) {
                    img.src = src;
                    img.removeAttribute('data-src');
                    imageObserver.unobserve(img);
                }
            }
        });
    }, {
        rootMargin: '50px',
        threshold: 0.1
    });

    document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
    });

    console.log('âœ… Lazy loading inicializado');
})();

// ===================================
// FIN DEL SCRIPT
// ===================================
console.log('ğŸ‰ Script completamente cargado y optimizado');
console.log('ğŸ“Š Estado de componentes:');
console.log('- Preloader:', document.getElementById('preloader') ? 'âœ…' : 'âŒ');
console.log('- MenÃº:', document.querySelector('.menu-toggle') ? 'âœ…' : 'âŒ');
console.log('- FAQ:', document.querySelector('.faq-list') ? 'âœ…' : 'âŒ');
console.log('- GalerÃ­a:', document.querySelector('.galeria-grid') ? 'âœ…' : 'âŒ');
console.log('- Lightbox:', document.getElementById('lightbox') ? 'âœ…' : 'âŒ');
